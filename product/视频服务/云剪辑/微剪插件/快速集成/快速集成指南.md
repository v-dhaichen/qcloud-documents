## 准备工作
- 已登录注册微信小程序并获得小程序的 appid。
- 已获得微剪插件使用权限。

>? 具体操作请参见 [准备工作](https://cloud.tencent.com/document/product/1156/45645)。

## 代码接入
### 步骤1：打开项目[](id:step1)
注册完成 [小程序](https://mp.weixin.qq.com/cgi-bin/wx?token=&lang=zh_CN) 后，在微信开发者工具里 [新建小程序项目](https://mp.weixin.qq.com/wxopen/waregister?action=step1)。
>? 若您当前已有小程序，直接打开即可。

### 步骤2：引入插件[](id:step2)
在项目根目录下的`app.json`中插入以下代码：
```
"plugins": {
    "myPlugin": {
     "provider": "wx76f1d77827f78beb",
     "version": "1.5.0"
    }
 }
```

在小程序目录新建`index.js`，暴露插件所需的接口:
```javascript
module.exports = {
  downloadFile:wx.downloadFile,
  loadFontFace: wx.loadFontFace,
  // 1.6.0版本新增模板功能，需要暴露文件系统接口实现本地包缓存
  getFileSystemManager: wx.getFileSystemManager,
  USER_DATA_PATH: wx.env.USER_DATA_PATH
}
```

> ! 由于插件更新频繁，上述的`version`版本号不一定是最新的，若要体验最新的特性请务必留意 [版本号](https://mp.weixin.qq.com/wxopen/pluginbasicprofile?action=intro&appid=wx76f1d77827f78beb&token=&lang=zh_CN) 。

* myPlugin：您自己定义的插件名称，可以改为其他名称。
* provider：使用的插件方，其值为微剪插件的 appid，即`wx76f1d77827f78beb`。
* version：微剪插件的 [版本号](https://mp.weixin.qq.com/wxopen/pluginbasicprofile?action=intro&appid=wx76f1d77827f78beb&token=&lang=zh_CN)，一般选择最新版本。

### 步骤3：接入组件或页面[](id:step3)
插件`1.6.0`版本新增模板功能，clip 中自带模板入口，原有接入组件方式不变；若需要直接访问模板页面，也可以通过配置页面跳转的方式实现。
1. 编写页面[](id:Write_page)
	1. 在项目中的 pages 目录下新建一个页面 clip：
```json
--- mini-program
  --- pages
   --- clip
​     --- clip.js
​     --- clip.json
​     --- clip.wxml
​     --- clip.wxss
```	2. 在 clip 页面对应的配置文件中加入以下代码引入 clip 组件：
```
 "usingComponents": {
   "my-clip": "plugin://myPlugin/clip"
  }
```
	3. 打开`clip.wxml`，编写页面模板：
```
 <view>
   <my-clip settings="{{settings}}"></my-clip>
 </view>
```
	4. 打开`clip.js`，将 settings 配置写入 data：
```
	Page({   
	 data: {
		settings: {
		 common: {
	​    videoMaxDuration: 30, // 小程序限制最多拍摄30秒
	​    chooseMaxDuration: 1000, // 选择视频的默认时长限制
	​    clipMaxDuration: 60, // 裁切时长的默认限制
			 }
			}
		 }
	})
```
2. 配置模板页跳转链接(仅1.6.0版本后支持)
通过配置模板页跳转链接的方式，可以直接跳转至模板页
```
<navigator url="plugin://myPlugin/main?mode=template">
   <view>视频模板</view>
</navigator>
```
>!此方式目前只支持如下方式配置导出页路径，其他的`settings`暂不支持，若有自定义的需求，请使用上述 [编写页面]() 的接入方式
```
<navigator url="plugin://myPlugin/main?mode=template&exportPath=/pages/export/index">
   <view>视频模板</view>
</navigator>
```

### 步骤4：预览[](id:step4)
单击开发者工具中的【预览】，进入 clip 页面即可看到组件成功加载。完成后即可进行拍摄编辑。

## 影集模式
插件 v1.5.0 版本开始，编辑页面新增了模式选择功能，其中**手动**模式即原有的模式，**影集**模式为版本新增，如下图所示：

<div align="">
<img src="https://imgcache.qq.com/operation/dianshi/other/v1.5.0_movie.e4ea167216d0782ac13a94a2c08d6d0693f7046d.gif" width="200" />
</div>

影集模式下，会为素材添加一系列的动效（变焦效果等）、转场动画以及从推荐音乐列表中随机选取一个背景音乐，用户也可以自行指定背景音乐，或者删除背景音乐。

>? 只有多个素材的情况才可使用影集模式，一个素材会默认为手动模式，也可以在插件 [settings](https://cloud.tencent.com/document/product/1156/48607#settings-.E5.8F.82.E6.95.B0.E8.AF.B4.E6.98.8E) 中配置`editMode: ['album', 'manual']`并选择编辑模式。

## 导出视频

导出操作提供了接口，支持自定义导出页面，如果没有自行实现的话会跳到我们默认提供的导出页面中。

### 步骤1：创建页面
在完成 [编写页面](#Write_page) 引入 clip 组件之后，还需要引入 export 实现导出操作。在项目的 pages 目录里新建 export 页面目录。
```json
--- mini-program
  --- pages
   --- clip
​     --- clip.js
​     --- clip.json
​     --- clip.wxml
​     --- clip.wxss
   --- export
​     --- export.js
​     --- export.json
​     --- export.wxml
​     --- export.wxss
```

### 步骤2：配置页面路径
在 clip 的 settings 中加上配置项，内部会在编辑完成后跳转到定制的导出页：
```
settings: {
  common: {
   videoMaxDuration: 30, // 小程序限制最多拍摄30秒
   chooseMaxDuration: 1000, // 选择视频的默认时长限制
   clipMaxDuration: 60, // 裁切时长的默认限制
   exportPagePath: '/pages/main/export/index' //导出页面路径
  }
 }
```
 
### 步骤3：组件引入
1. 在`export.json`中引入 export 组件：
```
 "usingComponents": {
		 "export": "plugin://myPlugin/export"
   }
```
2. 在`export.wxml`中编写模板：
```
<export
   bindexportsuccess="handleExportSuccess" watermark="https://cdn.cdn-go.cn/mp-video-edit-static/latest/images/watermark.png">
   <button>导出视频到本地</button>
</export>
```


